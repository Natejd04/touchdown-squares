<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Touchdown Squares - Football Pool</title>

     <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div id="toastContainer"></div>
    <div class="container">
        <div class="header">
            <h1>üèà TOUCHDOWN SQUARES üèà</h1>
            <div class="matchup">
                <svg class="team-logo" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#002244" stroke="#69BE28" stroke-width="3"/>
                    <path d="M30,35 Q50,25 70,35 L70,65 Q50,75 30,65 Z" fill="#69BE28"/>
                    <circle cx="50" cy="50" r="15" fill="#A5ACAF"/>
                    <text x="50" y="58" text-anchor="middle" font-size="20" fill="#002244" font-weight="bold">12</text>
                </svg>
                <span style="color: #69BE28; font-weight: bold;">SEAHAWKS</span>
                <span style="color: #ffd700;">vs</span>
                <span style="color: #C60C30; font-weight: bold;">PATRIOTS</span>
                <svg class="team-logo" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#002244" stroke="#C60C30" stroke-width="3"/>
                    <path d="M35,40 L45,30 L55,40 L60,35 L65,45 L70,40 L65,60 L35,60 Z" fill="#C60C30"/>
                    <circle cx="45" cy="45" r="3" fill="white"/>
                    <polygon points="50,50 55,55 50,65 45,55" fill="white"/>
                </svg>
            </div>
            <p class="tagline">Go Hawks! Show those deflated Patriots how real champions play! ü¶Öüíö</p>
        </div>

        <div id="authSection" class="auth-section">
            <div class="tabs">
                <button class="tab active" onclick="app.switchTab('login')">Login</button>
                <button class="tab" onclick="app.switchTab('signup')">Sign Up</button>
            </div>

            <div id="loginForm">
                <h2>Login</h2>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <div style="position: relative;">
                        <input type="password" id="loginPassword" placeholder="Password">
                        <button type="button" class="password-toggle" onclick="app.togglePasswordVisibility('loginPassword')">üëÅÔ∏è</button>
                    </div>
                </div>
                <div id="loginError" class="error"></div>
                <button class="btn btn-primary" onclick="app.login()">Login</button>
                <p style="margin-top: 15px; text-align: center;">
                    <a href="#" onclick="app.showResetPasswordModal(); return false;" style="color: #2d5a3d;">Forgot Password?</a>
                </p>
                <p style="margin-top: 10px; text-align: center;">
                    <a href="#" onclick="app.showInstructions(); return false;" style="color: #17a2b8; font-weight: bold;">üìñ How to Play</a>
                </p>
                <p style="margin-top: 10px; text-align: center;">
                    <a href="#" onclick="app.browseAsGuest(); return false;" style="color: #2d5a3d; font-weight: bold;">Browse as Guest (View Only)</a>
                </p>
            </div>

            <div id="signupForm" class="hidden">
                <h2>Sign Up</h2>
                <div class="form-group">
                    <label>First Name:</label>
                    <input type="text" id="signupFirstName" placeholder="First Name">
                </div>
                <div class="form-group">
                    <label>Last Name:</label>
                    <input type="text" id="signupLastName" placeholder="Last Name">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="signupEmail" placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <div style="position: relative;">
                        <input type="password" id="signupPassword" placeholder="Password (min 6 characters)">
                        <button type="button" class="password-toggle" onclick="app.togglePasswordVisibility('signupPassword')">üëÅÔ∏è</button>
                    </div>
                </div>
                <div id="signupError" class="error"></div>
                <div id="signupSuccess" class="success"></div>
                <button class="btn btn-primary" onclick="app.signup()">Sign Up</button>
            </div>
        </div>

        <div id="mainContent" class="main-content hidden">
            <div id="guestBanner" class="guest-banner hidden">
                üëÅÔ∏è You are browsing as a guest. <a onclick="app.exitGuestMode()">Login or Sign Up</a> to select squares and join the fun!
            </div>

            <div class="user-info">
                <div>
                    <strong>Welcome, <span id="userName"></span>!</strong>
                    <div class="token-display">üí∞ Tokens: <span id="userTokens">0</span></div>
                </div>
                <button class="btn btn-secondary" onclick="app.logout()">Logout</button>
            </div>

            <div class="nav-menu">
                <button class="nav-btn active" onclick="app.showSection('pools')">Football Pools</button>
                <button class="nav-btn" id="profileNavBtn" onclick="app.showSection('profile')">My Profile</button>
                <button class="nav-btn" id="activityNavBtn" style="display: none;" onclick="app.showSection('activity')">Activity Log</button>
                <button class="nav-btn" onclick="app.showInstructions()" style="background: #17a2b8; color: white;">üìñ How to Play</button>
            </div>

            <div id="adminPanel" class="hidden">
                <div class="admin-controls">
                    <h3>üîß Admin Controls</h3>
                    <button class="btn btn-primary" onclick="app.showCreatePoolModal()">Create New Pool</button>
                    <button class="btn btn-secondary" onclick="app.showManageUsersModal()">Manage User Tokens</button>
                    <button class="btn btn-secondary" onclick="app.exportData()">üíæ Export Data</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì• Import Data</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="app.importData(this.files[0])">
                </div>
            </div>

            <div id="poolsSection">
                <div id="poolsList">
                    <h2>Available Football Pools</h2>
                    <div class="pools-list" id="poolsContainer"></div>
                </div>

                <div id="poolView" class="hidden">
                    <button class="btn btn-secondary" onclick="app.backToPoolsList()">‚Üê Back to Pools</button>
                    <div id="poolDetails"></div>
                </div>
            </div>

            <div id="profileSection" class="hidden">
                <h2>My Profile</h2>
                <div class="profile-section" id="profileContent"></div>
            </div>

            <div id="activitySection" class="hidden">
                <h2>Activity Log</h2>
                <div class="profile-section">
                    <div class="activity-filters">
                        <h3>Filters</h3>
                        <div class="filter-row">
                            <div class="form-group">
                                <label>User:</label>
                                <select id="filterUser">
                                    <option value="">All Users</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Action:</label>
                                <select id="filterAction">
                                    <option value="">All Actions</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>From Date:</label>
                                <input type="date" id="filterFromDate">
                            </div>
                            <div class="form-group">
                                <label>To Date:</label>
                                <input type="date" id="filterToDate">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="app.applyActivityFilters()">Apply Filters</button>
                        <button class="btn btn-secondary" onclick="app.clearActivityFilters()">Clear Filters</button>
                    </div>
                    <div class="activity-log" id="activityLog"></div>
                    <div class="pagination" id="activityPagination"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="createPoolModal" class="modal">
        <div class="modal-content">
            <h2>Create New Pool</h2>
            <div class="form-group">
                <label>Pool Name:</label>
                <input type="text" id="newPoolName" placeholder="e.g., Super Bowl Squares">
            </div>
            <div class="form-group">
                <label>Tokens per Square:</label>
                <input type="number" id="newPoolTokens" value="1" min="1">
            </div>
            <div class="form-group">
                <label>Estimated Start Time:</label>
                <input type="datetime-local" id="newPoolStartTime">
            </div>
            <div id="createPoolError" class="error"></div>
            <button class="btn btn-primary" onclick="app.createPool()">Create Pool</button>
            <button class="btn btn-secondary" onclick="app.closeModal('createPoolModal')">Cancel</button>
        </div>
    </div>

    <div id="manageUsersModal" class="modal">
        <div class="modal-content">
            <h2>Manage User Tokens</h2>
            <div id="usersList"></div>
            <button class="btn btn-secondary" onclick="app.closeModal('manageUsersModal')">Close</button>
        </div>
    </div>

    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <h2>Change Password Required</h2>
            <p>Please change your password from the default.</p>
            <div class="form-group">
                <label>New Password:</label>
                <div style="position: relative;">
                    <input type="password" id="newPassword" placeholder="New Password (min 6 characters)">
                    <button type="button" class="password-toggle" onclick="app.togglePasswordVisibility('newPassword')">üëÅÔ∏è</button>
                </div>
            </div>
            <div class="form-group">
                <label>Confirm Password:</label>
                <div style="position: relative;">
                    <input type="password" id="confirmPassword" placeholder="Confirm Password">
                    <button type="button" class="password-toggle" onclick="app.togglePasswordVisibility('confirmPassword')">üëÅÔ∏è</button>
                </div>
            </div>
            <div id="changePasswordError" class="error"></div>
            <button class="btn btn-primary" onclick="app.changePassword()">Change Password</button>
        </div>
    </div>

    <div id="resetPasswordModal" class="modal">
        <div class="modal-content">
            <h2>Reset Password</h2>
            <p>Enter your email to receive a password reset link (valid for 15 minutes).</p>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="resetEmail" placeholder="your@email.com">
            </div>
            <div id="resetError" class="error"></div>
            <div id="resetSuccess" class="success"></div>
            <button class="btn btn-primary" onclick="app.requestPasswordReset()">Send Reset Link</button>
            <button class="btn btn-secondary" onclick="app.closeModal('resetPasswordModal')">Cancel</button>
        </div>
    </div>

    <div id="assignSquareModal" class="modal">
        <div class="modal-content">
            <h2>Assign Square to User</h2>
            <div class="form-group">
                <label>Select User:</label>
                <select id="assignSquareUser"></select>
            </div>
            <div id="assignSquareError" class="error"></div>
            <button class="btn btn-primary" onclick="app.confirmAssignSquare()">Assign Square</button>
            <button class="btn btn-secondary" onclick="app.closeModal('assignSquareModal')">Cancel</button>
        </div>
    </div>

    <div id="editStartTimeModal" class="modal">
        <div class="modal-content">
            <h2>Edit Start Time</h2>
            <div class="form-group">
                <label>Start Time:</label>
                <input type="datetime-local" id="editStartTime">
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="removeStartTime"> Remove start time (hide countdown)
                </label>
            </div>
            <div id="editStartTimeError" class="error"></div>
            <button class="btn btn-primary" onclick="app.confirmEditStartTime()">Save Changes</button>
            <button class="btn btn-secondary" onclick="app.closeModal('editStartTimeModal')">Cancel</button>
        </div>
    </div>

    <div id="randomSelectModal" class="modal">
        <div class="modal-content">
            <h2>üé≤ Random Square Selection</h2>
            <div id="randomSelectContent"></div>
            <div id="randomSelectError" class="error"></div>
            <div id="randomSelectSuccess" class="success"></div>
            <button class="btn btn-primary" id="randomSelectConfirmBtn" onclick="app.confirmRandomSelection()">Select Randomly</button>
            <button class="btn btn-secondary" onclick="app.closeModal('randomSelectModal')">Cancel</button>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div id="instructionsModal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <span class="close" onclick="app.closeModal('instructionsModal')">&times;</span>
            <h2>üìñ How to Play Football Squares</h2>
            
            <div class="instructions-section">
                <h3>üéØ What Are Football Squares?</h3>
                <p>Football Squares is a fun betting game where you claim squares on a 10x10 grid. Each square represents a potential score combination. Winners are determined by the last digit of each team's score at the end of each quarter and the final score!</p>
                
                <div class="grid-example">
                    <div style="text-align: center; margin: 15px 0;">
                        <strong>Example Grid:</strong>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(4, 60px); gap: 2px; justify-content: center; margin: 10px 0;">
                        <div style="background: #f8f9fa; padding: 8px; text-align: center; font-weight: bold;">üèà</div>
                        <div style="background: #2d5a3d; color: white; padding: 8px; text-align: center;">3</div>
                        <div style="background: #2d5a3d; color: white; padding: 8px; text-align: center;">7</div>
                        <div style="background: #2d5a3d; color: white; padding: 8px; text-align: center;">0</div>
                        
                        <div style="background: #c62828; color: white; padding: 8px; text-align: center;">4</div>
                        <div style="background: white; border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 0.8em;">Empty</div>
                        <div style="background: #c8e6c9; border: 2px solid #4caf50; padding: 8px; text-align: center; font-size: 0.8em;">You</div>
                        <div style="background: #bbdefb; padding: 8px; text-align: center; font-size: 0.8em;">Sarah</div>
                        
                        <div style="background: #c62828; color: white; padding: 8px; text-align: center;">1</div>
                        <div style="background: #bbdefb; padding: 8px; text-align: center; font-size: 0.8em;">Mike</div>
                        <div style="background: white; border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 0.8em;">Empty</div>
                        <div style="background: #bbdefb; padding: 8px; text-align: center; font-size: 0.8em;">Lisa</div>
                        
                        <div style="background: #c62828; color: white; padding: 8px; text-align: center;">9</div>
                        <div style="background: #bbdefb; padding: 8px; text-align: center; font-size: 0.8em;">Tom</div>
                        <div style="background: #bbdefb; padding: 8px; text-align: center; font-size: 0.8em;">Amy</div>
                        <div style="background: white; border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 0.8em;">Empty</div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; font-size: 0.9em; color: #666;">
                        <strong>Seahawks (Green)</strong> scores across the top<br>
                        <strong>Patriots (Red)</strong> scores down the side
                    </div>
                </div>
            </div>

            <div class="instructions-section">
                <h3>üí∞ Getting Tokens</h3>
                <p><strong>Tokens are your currency!</strong> You use tokens to claim squares.</p>
                <ul>
                    <li>An <strong>admin must grant you tokens</strong> to start playing</li>
                    <li>Each square costs a certain number of tokens (shown in the pool details)</li>
                    <li><strong>‚ö†Ô∏è Important:</strong> Once you use up all your tokens, you cannot get more unless an admin grants them</li>
                    <li>Spend wisely!</li>
                </ul>
            </div>

            <div class="instructions-section">
                <h3>üéÆ How to Select Squares</h3>
                <p><strong>Step 1:</strong> Browse available pools and choose one to join</p>
                <p><strong>Step 2:</strong> Tap any <span style="background: white; border: 1px solid #ddd; padding: 2px 8px;">white (empty)</span> square to claim it</p>
                <ul>
                    <li><span style="background: #c8e6c9; border: 2px solid #4caf50; padding: 2px 8px;">Green squares</span> = Your squares</li>
                    <li><span style="background: #bbdefb; padding: 2px 8px;">Blue squares</span> = Other players' squares</li>
                    <li><span style="background: white; border: 1px solid #ddd; padding: 2px 8px;">White squares</span> = Available to claim</li>
                </ul>
                <p><strong>Step 3:</strong> Confirm your selection and spend the required tokens</p>
            </div>

            <div class="instructions-section">
                <h3>üîÑ Changing Your Mind</h3>
                <p><strong>You CAN unselect your squares!</strong></p>
                <ul>
                    <li>Click on any of <span style="background: #c8e6c9; border: 2px solid #4caf50; padding: 2px 8px;">your green squares</span></li>
                    <li>Confirm you want to remove it</li>
                    <li>Your tokens will be <strong>refunded immediately</strong></li>
                    <li>‚ö†Ô∏è <strong>Only works BEFORE the game starts!</strong> Once locked, no changes allowed</li>
                </ul>
            </div>

            <div class="instructions-section">
                <h3>üîí When Games Start</h3>
                <p><strong>Games lock automatically when:</strong></p>
                <ul>
                    <li>All 100 squares are filled, OR</li>
                    <li>The admin manually locks the pool</li>
                </ul>
                <p><strong>After locking:</strong></p>
                <ul>
                    <li>‚ùå No more square selections allowed</li>
                    <li>‚ùå Cannot unselect squares</li>
                    <li>The admin assigns random numbers (?) to rows and columns</li>
                    <li>The game begins!</li>
                </ul>
            </div>

            <div class="instructions-section">
                <h3>‚ùå If a Pool Doesn't Fill</h3>
                <p><strong>Don't worry!</strong> If not all squares are claimed:</p>
                <ul>
                    <li>The admin may <strong>delete the pool</strong></li>
                    <li>All participants get their <strong>tokens refunded</strong> automatically</li>
                    <li>No one loses anything!</li>
                </ul>
            </div>

            <div class="instructions-section">
                <h3>üèÜ How Winners Are Determined</h3>
                <p><strong>Winners are based on the last digit of each team's score!</strong></p>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <strong>Example:</strong><br>
                    End of 1st Quarter: Seahawks 17, Patriots 14<br>
                    Last digits: <strong>7</strong> (Seahawks) and <strong>4</strong> (Patriots)<br>
                    Winner: Person with square at row 4, column 7!
                </div>

                <p><strong>5 Chances to Win:</strong></p>
                <ol>
                    <li><strong>1st Quarter:</strong> Winner gets 20% of pool</li>
                    <li><strong>2nd Quarter:</strong> Winner gets 20% of pool</li>
                    <li><strong>3rd Quarter:</strong> Winner gets 20% of pool</li>
                    <li><strong>4th Quarter:</strong> Winner gets 20% of pool</li>
                    <li><strong>Final Score:</strong> Winner gets 20% of pool</li>
                </ol>

                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #ffc107;">
                    <strong>üí° Overtime Tip:</strong><br>
                    If there's NO overtime, the 4th quarter and final score are usually the same, so that winner gets <strong>40% of the pool</strong>!<br>
                    If there IS overtime, they're different, creating 5 separate winners.
                </div>
            </div>

            <div class="instructions-section">
                <h3>üé≤ Random Selection</h3>
                <p>Can't decide which squares to pick? Use <strong>Random Selection!</strong></p>
                <ul>
                    <li>Click "üé≤ Random" button</li>
                    <li>Choose how many squares you want (1-20)</li>
                    <li>The system randomly picks squares for you</li>
                    <li>Costs the same tokens as manual selection</li>
                </ul>
            </div>

            <div class="instructions-section">
                <h3>üìä Tracking Your Squares</h3>
                <ul>
                    <li>Your squares are highlighted in <span style="background: #c8e6c9; border: 2px solid #4caf50; padding: 2px 8px;">green</span></li>
                    <li>Check the "Activity Log" to see your selections</li>
                    <li>Your remaining tokens are shown at the top of the page</li>
                    <li>Winner squares light up in <span style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); padding: 2px 8px;">gold</span> after scores are entered!</li>
                </ul>
            </div>

            <div class="instructions-section">
                <h3>‚ùì Important Notes</h3>
                <ul>
                    <li><strong>Random Numbers:</strong> The <strong>?</strong> on the grid are randomly assigned when the game starts</li>
                    <li><strong>Token Limits:</strong> You can only spend tokens you have. Plan wisely!</li>
                    <li><strong>Multiple Pools:</strong> You can join multiple pools if you have enough tokens</li>
                    <li><strong>Same Winner:</strong> Yes, you can win multiple quarters with the same square!</li>
                    <li><strong>Fair Play:</strong> All squares have equal chance - no square is "better" until numbers are assigned</li>
                </ul>
            </div>

            <div class="instructions-section" style="background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #4caf50;">
                <h3>üéâ Good Luck!</h3>
                <p style="margin: 0;">Football Squares is all about luck and fun! Pick your squares, watch the game, and may the odds be ever in your favor!</p>
                <p style="margin: 10px 0 0 0; font-weight: bold;">Go Hawks! ü¶Öüíö</p>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" onclick="app.closeModal('instructionsModal')">Got It!</button>
            </div>
        </div>
    </div>

    <script type="module" src="./main.js"></script>
</body>
</html>
